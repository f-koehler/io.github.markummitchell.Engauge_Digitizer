{
        "app-id": "io.github.markummitchell.Engauge_Digitizer",
        "runtime": "org.kde.Platform",
        "runtime-version": "5.11",
        "sdk": "org.kde.Sdk",
        "command": "engauge",
        "rename-icon": "engauge-digitizer",
        "copy-icon": true,
        "rename-desktop-file": "engauge-digitizer.desktop",
        "rename-appdata-file": "engauge-digitizer.appdata.xml",
        "finish-args": [
                "--socket=wayland",
                "--socket=x11",
                "--share=network",
                "--filesystem=host",
                "--share=ipc",
                "--device=dri"
        ],
        "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/lib/cmake",
                "/share/aclocal",
                "/share/pkgconfig",
                "*.a",
                "*.la",
                "*.cmake"
        ],
        "modules": [
                {
                        "name": "log4cpp",
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "https://sourceforge.net/projects/log4cpp/files/log4cpp-1.1.x%20%28new%29/log4cpp-1.1/log4cpp-1.1.3.tar.gz",
                                        "sha256": "2cbbea55a5d6895c9f0116a9a9ce3afb86df383cd05c9d6c1a4238e5e5c8f51d",
                                        "strip-components": 2
                                }
                        ]
                },
                {
                        "name": "fftw3",
                        "no-autogen": true,
                        "config-opts": [
                                "--enable-shared",
                                "--enable-threads"
                        ],
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                                        "sha256": "3b609b7feba5230e8f6dd8d245ddbefac324c5a6ae4186947670d9ac2cd25573"
                                }
                        ]
                },
                {
                        "name": "openjpeg",
                        "buildsystem": "cmake-ninja",
                        "config-opts": [
                                "-DCMAKE_BUILD_TYPE=Release"
                        ],
                        "cleanup": [
                                "/bin",
                                "/lib/openjpeg-*",
                                "*.a"
                        ],
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "https://github.com/uclouvain/openjpeg/archive/v2.3.0.tar.gz",
                                        "sha256": "3dc787c1bb6023ba846c2a0d9b1f6e179f1cd255172bde9eb75b01f1e6c7d71a"
                                }
                        ]
                },
                {
                        "name": "poppler-data",
                        "buildsystem": "cmake-ninja",
                        "builddir": true,
                        "config-opts": [
                                "-DCMAKE_BUILD_TYPE=Release"
                        ],
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "https://poppler.freedesktop.org/poppler-data-0.4.9.tar.gz",
                                        "sha256": "1f9c7e7de9ecd0db6ab287349e31bf815ca108a5a175cf906a90163bdbe32012"
                                }
                        ]
                },
                {
                        "name": "poppler",
                        "buildsystem": "cmake-ninja",
                        "builddir": true,
                        "config-opts": [
                                "-DCMAKE_BUILD_TYPE=Release",
                                "-DBUILD_GTK_TESTS=OFF",
                                "-DBUILD_QT5_TESTS=OFF",
                                "-DBUILD_CPP_TESTS=OFF",
                                "-DENABLE_GLIB=OFF"
                        ],
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "https://poppler.freedesktop.org/poppler-0.70.1.tar.xz",
                                        "sha256": "66972047d9ef8162cc8c389d7e7698291dfc9f2b3e4ea9a9f08ae604107451bd"
                                }
                        ]
                },
                {
                        "name": "engauge",
                        "build-options": {
                                "env": {
                                        "FFTW_HOME": "/app",
                                        "LOG4CPP_HOME": "/app"
                                }
                        },
                        "buildsystem": "simple",
                        "sources": [
                                {
                                        "type": "archive",
                                        "url": "https://github.com/markummitchell/engauge-digitizer/archive/v12.1.tar.gz",
                                        "sha256": "b553c71ad8b5565a42ae0ba58891d27ac47ca27cc6d7a442c979b56b1fbda282"
                                }
                        ],
                        "build-commands": [
                                "echo Skipping call to qcollectiongenerator which segfaults in flatpak-builder",
                                "mkdir -p bin/documentation",
                                "cp dev/flatpak/engauge.qch bin/documentation",
                                "cp dev/flatpak/engauge.qhc bin/documentation",
                                "qmake CONFIG=release",
                                "make",
                                "install -D -m 755 bin/engauge /app/bin/engauge",
                                "install -D -m 644 bin/documentation/engauge.qch /app/bin/documentation/engauge.qch",
                                "install -D -m 644 bin/documentation/engauge.qhc /app/bin/documentation/engauge.qhc",
                                "install -D -m 644 dev/engauge-digitizer.desktop /app/share/applications/engauge-digitizer.desktop",
                                "install -D -m 644 dev/gnome/engauge-digitizer.appdata.xml /app/share/metainfo/engauge-digitizer.appdata.xml",
                                "install -D -m 644 src/img/engauge-digitizer.svg /app/share/icons/hicolor/scalable/apps/engauge-digitizer.svg"
                        ]
                }
        ]
}
